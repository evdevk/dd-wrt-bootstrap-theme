// Generated by CoffeeScript 1.4.0
(function() {
  var $;

  $ = jQuery;

  $.fn.renderImage = function() {
    var $this, arg, d_height, d_width, file, image, imageType, onfinish, reader, ret;
    $this = $(this);
    if (arguments.length < 1) {
      return false;
    }
    if (arguments.length === 1) {
      arg = arguments[0];
      if (arg instanceof File) {
        file = arg;
      } else {
        file = arg.file;
        d_width = arg.width;
        d_height = arg.height;
        onfinish = arg.onFinish;
      }
    } else {
      file = arguments[0];
      d_width = arguments[1];
      d_height = arguments[2];
      onfinish = arguments[3];
    }
    if (!(file instanceof File)) {
      return false;
    }
    imageType = /image.*/;
    if (!file.type.match(imageType)) {
      return false;
    }
    image = document.createElement("img");
    image.file = file;
    $(image).css("display", "none");
    document.body.appendChild(image);
    reader = new FileReader();
    reader.onload = function(e) {
      return image.src = e.target.result;
    };
    ret = reader.readAsDataURL(file);
    image.onload = function() {
      var canvas, ctx, dr, s_height, s_width, sh, sr, sw;
      s_height = $(this).height();
      s_width = $(this).width();
      sr = s_width / s_height;
      if (!d_width) {
        d_width = s_width;
      }
      if (!d_height) {
        d_height = s_height;
      }
      dr = d_width / d_height;
      if (dr > sr) {
        sw = s_width;
        sh = s_width / dr;
      } else {
        sh = s_height;
        sw = s_height * dr;
      }
      if ($this[0].tagName.toLowerCase() === "canvas") {
        canvas = $this[0];
      } else {
        canvas = document.createElement("canvas");
        $this.append(canvas);
      }
      ctx = canvas.getContext("2d");
      canvas.width = d_width;
      canvas.height = d_height;
      ctx.drawImage(image, 0, 0, sw, sh, 0, 0, d_width, d_height);
      $(image).remove();
      if (onfinish) {
        return onfinish.call();
      }
    };
    return true;
  };

}).call(this);
